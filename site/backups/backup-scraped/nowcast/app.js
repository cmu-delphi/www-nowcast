/*
 ____   ___    _   _  ___ _____   _____ ____ ___ _____ 
|  _ \ / _ \  | \ | |/ _ \_   _| | ____|  _ \_ _|_   _|
| | | | | | | |  \| | | | || |   |  _| | | | | |  | |  
| |_| | |_| | | |\  | |_| || |   | |___| |_| | |  | |  
|____/ \___/  |_| \_|\___/ |_|   |_____|____/___| |_|  
                                                       
        Automatically generated from sources at:       
       https://github.com/cmu-delphi/www-nowcast       
                                                       
 Commit hash: 1b575644f1a28da7378aad0e83bd41a7885295e2 
     Deployed at: 2018-05-01 18:40:03 (1525214403)     
*/



(function(){var t,e,n,o,a,i,r,s,h,l,c,u,p,f,d,g,w,M,m,v,k,_,T,y,D,N,E,A,I,C,S,x,L,W,b,O,H,P,z,R,V,K,Y,X,F,U,J,G,Z,B,j,q,Q,tt,et,nt,ot,at,it,rt,st,ht,lt,ct,ut,pt,ft,dt,gt,wt,Mt,mt,vt,kt,_t,Tt,yt,Dt,Nt,Et,At,It,Ct,St,$t,xt=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};for(x=Math.PI/180,Q=function(t,e,n){var o,a,i,r,s,h,l,c,u,p,f,d,g,w,M,m;return null==n&&(n=0),c=[t*x,e*x],t=c[0],e=c[1],u=[Math.cos(t),Math.cos(e)],s=u[0],h=u[1],p=[Math.sin(t),Math.sin(e)],d=p[0],g=p[1],f=[6378137,Math.pow(298.257223563,-1)],r=f[0],l=f[1],o=Math.pow(Math.pow(s,2)+Math.pow((1-l)*d,2),-.5),i=Math.pow(1-l,2)*o,a=n/r,w=(o+a)*s*h,M=(o+a)*s*g,m=(i+a)*d,[w,M,m]},R=function(t,e,n,o,a){var i,r,s,h,l,c,u,p,f,d,g,w,M,m,v,k,_,T,y;return g=[t*x,e*x],c=g[0],u=g[1],w=[Math.sin(c),Math.cos(c)],k=w[0],s=w[1],M=[Math.sin(u),Math.cos(u)],_=M[0],h=M[1],m=[o/2,a/2],T=m[0],d=m[1],y=Math.min(T,d)*n,v=[-_*y,h*y,h*k*y,k*_*y,-s*y],i=v[0],r=v[1],l=v[2],p=v[3],f=v[4],function(t,e,n){return[T+t*i+e*r,d+t*l+e*p+n*f]}},K=[],ft=geodata.locations.HI.paths,Y=0,F=ft.length;Y<F;Y++)for(ct=ft[Y],et=0,U=ct.length;et<U;et++)V=ct[et],xt.call(K,V)<0&&K.push(V);for(rt=0,J=K.length;rt<J;rt++)V=K[rt],dt=geodata.points[V],X=dt[0],tt=dt[1],geodata.points[V]=[X+5,tt+50];for(K=[],vt=geodata.locations.AK.paths,ht=0,G=vt.length;ht<G;ht++)for(ct=vt[ht],lt=0,Z=ct.length;lt<Z;lt++)V=ct[lt],xt.call(K,V)<0&&K.push(V);for(kt=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE],at=kt[0],it=kt[1],nt=kt[2],ot=kt[3],ut=0,B=K.length;ut<B;ut++)V=K[ut],_t=geodata.points[V],X=_t[0],tt=_t[1],tt<0&&(Tt=[Math.min(at,tt),Math.min(it,X),Math.max(nt,tt),Math.max(ot,X)],at=Tt[0],it=Tt[1],nt=Tt[2],ot=Tt[3]);for(yt=[(at+nt)/2,(it+ot)/2],I=yt[0],C=yt[1],pt=0,j=K.length;pt<j;pt++)V=K[pt],Dt=geodata.points[V],X=Dt[0],tt=Dt[1],tt>0&&(tt-=360),W=12*Math.abs(tt-I)/17,L=9*Math.abs(X-C)/17,X>C?X-=L:X+=L,tt>I?tt-=W:tt+=W,tt<-180&&(tt+=360),geodata.points[V]=[X-35,tt-10];for(V=At=0,Nt=geodata.points.length;0<=Nt?At<Nt:At>Nt;V=0<=Nt?++At:--At)Et=geodata.points[V],X=Et[0],tt=Et[1],geodata.points[V]=Q(X,tt),tt>=0&&(tt-=360),0===V&&(gt=[tt,tt,X,X],It=gt[0],Ct=gt[1],St=gt[2],$t=gt[3]),wt=[Math.min(St,X),Math.max($t,X)],St=wt[0],$t=wt[1],Mt=[Math.min(It,tt),Math.max(Ct,tt)],It=Mt[0],Ct=Mt[1];mt=[It,Ct,St,$t],p=mt[0],u=mt[1],l=mt[2],h=mt[3],T=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],f=["January","February","March","April","May","June","July","August","September","October","November","December"],g=["nat"],i=["hhs1","hhs2","hhs3","hhs4","hhs5","hhs6","hhs7","hhs8","hhs9","hhs10"],e=["cen1","cen2","cen3","cen4","cen5","cen6","cen7","cen8","cen9"],k=i.concat(e),_=["AK","AL","AR","AZ","CA","CO","CT","DC","DE","FL","GA","HI","IA","ID","IL","IN","KS","KY","LA","MA","MD","ME","MI","MN","MO","MS","MT","NC","ND","NE","NH","NJ","NM","NV","NY","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VA","VT","WA","WI","WV","WY"],c=g.concat(k).concat(_),s=["AK","AZ","CA","CO","ID","KS","LA","MD","ME","MS","MT","NC","ND","NE","NH","OH","OR","PA","RI","TN","TX","VA","VI","VT","WI","WV","WY"],r=["AK","AL","AR","AZ","CA","CO","CT","DE","FL","GA","IA","ID","IL","IN","KS","LA","MA","MD","ME","MI","MN","MO","MS","MT","NC","NE","NH","NJ","NM","NV","NY","OH","OK","OR","RI","SC","SD","TN","TX","VT","WI","WV","WY"],d={FL:"Florida",cen4:"West North Central",hhs9:"HHS Region 9",MT:"Montana",WV:"West Virginia",RI:"Rhode Island",AR:"Arkansas",VA:"Virginia",cen7:"West South Central",IN:"Indiana",NC:"North Carolina",IA:"Iowa",MN:"Minnesota",cen2:"Middle Atlantic",DE:"Delaware",PA:"Pennsylvania",hhs7:"HHS Region 7",nat:"US National",hhs10:"HHS Region 10",LA:"Louisiana",MD:"Maryland",AK:"Alaska",CO:"Colorado",WI:"Wisconsin",ID:"Idaho",OK:"Oklahoma",hhs3:"HHS Region 3",hhs2:"HHS Region 2",hhs1:"HHS Region 1",cen1:"New England",KY:"Kentucky",ME:"Maine",CA:"California",cen5:"South Atlantic",WY:"Wyoming",ND:"North Dakota",NY:"New York",MA:"Massachusetts",UT:"Utah",DC:"District of Columbia",MS:"Mississippi",hhs6:"HHS Region 6",GA:"Georgia",AL:"Alabama",HI:"Hawaii",hhs4:"HHS Region 4",AZ:"Arizona",CT:"Connecticut",KS:"Kansas",NH:"New Hampshire",cen8:"Mountain",TX:"Texas",NV:"Nevada",TN:"Tennessee",NJ:"New Jersey",MI:"Michigan",hhs8:"HHS Region 8",NM:"New Mexico",IL:"Illinois",cen3:"East North Central",VT:"Vermont",WA:"Washington",SD:"South Dakota",NE:"Nebraska",hhs5:"HHS Region 5",SC:"South Carolina",cen6:"East South Central",OR:"Oregon",cen9:"Pacific",MO:"Missouri",OH:"Ohio"},v={hhs1:["ME","MA","NH","VT","RI","CT"],hhs2:["NY","NJ"],hhs3:["PA","DE","DC","MD","VA","WV"],hhs4:["NC","SC","GA","FL","KY","TN","MS","AL"],hhs5:["MI","IL","IN","OH","WI","MN"],hhs6:["LA","AR","OK","TX","NM"],hhs7:["IA","MO","NE","KS"],hhs8:["ND","SD","CO","WY","MT","UT"],hhs9:["NV","CA","HI","AZ"],hhs10:["WA","OR","AK","ID"],cen1:["ME","MA","NH","VT","RI","CT"],cen2:["PA","NY","NJ"],cen3:["WI","MI","IN","IL","OH"],cen4:["ND","SD","NE","KS","MN","IA","MO"],cen5:["DE","MD","DC","WV","VA","NC","SC","GA","FL"],cen6:["KY","TN","MS","AL"],cen7:["OK","AR","LA","TX"],cen8:["MT","ID","WY","CO","UT","NV","AZ","NM"],cen9:["WA","OR","CA","AK","HI"]},M={AK:731449,AL:4822023,AR:2949131,AZ:6553255,CA:38041430,CO:5187582,CT:3590347,DC:632323,DE:917092,FL:19317568,GA:9919945,HI:1392313,IA:3074186,ID:1595728,IL:12875255,IN:6537334,KS:2885905,KY:4380415,LA:4601893,MA:6646144,MD:5884563,ME:1329192,MI:9883360,MN:5379139,MO:6021988,MS:2984926,MT:1005141,NC:9752073,ND:699628,NE:1855525,NH:1320718,NJ:8864590,NM:2085538,NV:2758931,NY:19570261,OH:11544225,OK:3814820,OR:3899353,PA:12763536,RI:1050292,SC:4723723,SD:833354,TN:6456243,TX:26059203,UT:2855287,VA:8185867,VT:626011,WA:6897012,WI:5726398,WV:1855413,WY:576412},w=2015,N=function(t){var e,n,o,a;for(n=0,o=0,e=t.length;o<e;o++)a=t[o],n+=a;return n/t.length},A=function(t,e){var n,o,a,i;for(o=0,a=0,n=t.length;a<n;a++)i=t[a],o+=Math.pow(i-e,2);return Math.pow(o/(t.length-1),.5)},E=function(t,e){var n,o,a,r,s,h,l,u,p,f,d,g,w,M,m,k,_,T,y,D,E,I,C;for(n={},g={},y=0,u=c.length;y<u;y++)d=c[y],g[d]={};for(o=0,p=t.length;o<p;o++)k=t[o],C=k.epiweek%100,g[k.location][C]=k.value;for(a=0,f=i.length;a<f;a++)for(m=i[a],I=nonInfluenzaWeekData[e][m],M=v[m],r=0,h=M.length;r<h;r++){for(_=M[r],D=[],s=0,l=I.length;s<l;s++)E=I[s],D.push(g[_][E]);w=N(D),T=A(D,w),n[_]=[w,T]}return n},D=function(t,e,n){var o,a,i,r,s,h,l,c,u,p,f,d,g,w,m,T,D,N,E,A,I,C,S,$,x,L,W,b;for(D={},m={},o={},b=0,f=e.length;b<f;b++)x=e[b],(x.epiweek=n)&&(D[x.location]=x.value);for(a=0,d=_.length;a<d;a++)L=_[a],I=t[L],N=I[0],W=I[1],i=D[L],w=y(i,N,W),o[L]=q(w),m[L]=w;for(r=0,g=k.length;r<g;r++){for($=k[r],A=0,C=v[$],s=0,l=C.length;s<l;s++)L=C[s],A+=M[L];for(w=0,S=v[$],h=0,c=S.length;h<c;h++)L=S[h],w+=M[L]/A*m[L];o[$]=q(w),m[$]=w}for(A=0,T=0,u=_.length;T<u;T++)L=_[T],A+=M[L];for(w=0,E=0,p=_.length;E<p;E++)L=_[E],w+=M[L]/A*m[L];return o.nat=q(w),m.nat=w,o},y=function(t,e,n){var o;return o=(t-e)/n,o<1.1?1:o<2.5?2:o<4?3:o<4.9?4:o<6?5:o<7.6?6:o<8?7:o<9.5?8:o<12?9:10},q=function(t){return Math.max(0,Math.min(10,t))/10},Date.prototype.getWeek=function(){var t,e;return e=new Date(2016,0,3),t=Math.ceil(((this-e)/864e5+e.getDay()+1)/7)%52,0===t?52:t},S=function(t){return f[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear()},b=function(t){var e,n,o,a;return n=new Date(2016,0,3),o=t%100,a=Math.floor(t/100),e=7*(52*(a-2016)+o-1),n.setDate(n.getDate()+e),n},H=function(t){var e,n,o,a,i,r,s;for(a=[t,t],o=a[0],n=a[1],V=s=0;s<10;V=++s)i=O(o),o=i[0],e=i[1],r=O(n),e=r[0],n=r[1];return[o,n]},O=function(t){var e,n,o,a;return o=t%100,a=Math.floor(t/100),n=t-1,e=t+1,1===o&&(n=100*(a-1)+52),52===o&&(e=100*(a+1)+1),[n,e]},z=function(t,e){return{location:t,epiweek:201201+100*Math.floor(e/52)+e%52,value:1+3*Math.random(),std:.5+1*Math.random(),wili:1+3*Math.random()}},st=function(t){return 2===t.length?t.toUpperCase():t.toLowerCase()},P=function(t){return function(e,n,o){var a,i,r,s;if(1===e){for(s=0,a=o.length;s<a;s++)r=o[s],null!=r.location&&(r.location=st(r.location)),null!=r.region&&(r.region=st(r.region));return t(o)}return i="The Epidata API says '"+n+"'. (error #"+e+")",console.log(i),alert(i)}},n=function(t,e,n){var o,a,i;return null!=("undefined"!=typeof Epidata&&null!==Epidata?Epidata.fluview:void 0)?Epidata.fluview(t,e,n):(i=function(){var t,n;for(t=[],V=n=0;n<280;V=++n)t.push(z(e,V));return t}(),o=function(){return t(1,"debug",i)},a=250+Math.round(500*Math.random()),window.setTimeout(o,a))},a=function(t,e){var n,o,a;return null!=("undefined"!=typeof Epidata&&null!==Epidata?Epidata.nowcast:void 0)?Epidata.nowcast(t,e,"201130-202030"):(a=function(){var t,n;for(t=[],V=n=0;n<280;V=++n)t.push(z(e,V));return t}(),n=function(){return t(1,"debug",a)},o=250+Math.round(500*Math.random()),window.setTimeout(n,o))},o=function(t,e,n,o){var a,i,r,s,h,l,c;if(null!=("undefined"!=typeof Epidata&&null!==Epidata?Epidata.nowcast:void 0))return Epidata.nowcast(t,e,Epidata.range(n,o));for(r=[],c=0,h=e.length;c<h;c++)for(l=e[c],V=s=0;s<280;V=++s)r.push(z(l,V));return a=function(){return t(1,"debug",r)},i=250+Math.round(500*Math.random()),window.setTimeout(a,i)},m=function(){function t(t,e){this.elem=t,this.listener=e,this.elem.on("mousedown touchstart",function(t){return function(e){return t.onDown(e)}}(this)),this.elem.on("mouseup touchend",function(t){return function(e){return t.onUp(e)}}(this)),this.elem.on("mousemove touchmove",function(t){return function(e){return t.onMove(e)}}(this)),this.elem.on("mouseleave touchleave",function(t){return function(e){return t.onLeave(e)}}(this)),this.elem.on("wheel",function(t){return function(e){return t.onWheel(e)}}(this))}var e;return e=5,t.prototype._get_xyt=function(t){var e,n,o;return(null!=(n=t.touches)?n.length:void 0)>0?(o=t.touches.item(0),e=this.elem.offset(),[o.pageX-e.left,o.pageY-e.top,+new Date]):[t.offsetX,t.offsetY,+new Date]},t.prototype.onDown=function(t){return this.last=this.down=this._get_xyt(t)},t.prototype.onUp=function(t){var n,o,a,i;if(null!=this.down)return n=this.down,It=n[0],St=n[1],a=n[2],o=this._get_xyt(t),Ct=o[0],$t=o[1],i=o[2],this.down=null,Math.pow(Math.pow(Ct-It,2)+Math.pow($t-St,2),.5)<e?this.listener.onClick((It+Ct)/2,(St+$t)/2):void 0},t.prototype.onMove=function(t){var e,n,o,a;if(null!=this.down)return t.preventDefault(),this.curr=this._get_xyt(t),e=this.last,It=e[0],St=e[1],o=e[2],n=this.curr,Ct=n[0],$t=n[1],a=n[2],this.last=this.curr,this.listener.onDrag(Ct,$t,Ct-It,$t-St)},t.prototype.onLeave=function(t){return this.down=null},t.prototype.onWheel=function(t){return this.listener.onScroll(t.originalEvent.deltaY)},t}(),window.App=t=function(){function t(){var t,n,o,a,r,s,h,l,c,u,p,f,d,v;t=function(t){return function(e,n){return function(){return $(".button_group0 i").removeClass("fa-dot-circle-o"),$(".button_group0 i").addClass("fa-circle-o"),$("#button_view_"+e+" i").removeClass("fa-circle-o"),$("#button_view_"+e+" i").addClass("fa-dot-circle-o"),t.setLocations(n)}}}(this),s=[-1,-1,-1,-1,-1,-1,-1,-1],c=s[0],u=s[1],h=s[2],l=s[3],d=s[4],v=s[5],p=s[6],f=s[7],n=!1,o=function(t){return function(){var e,n;return e=Math.pow(Math.pow(c-u,2)+Math.pow(d-v,2),.5),n=Math.pow(Math.pow(h-l,2)+Math.pow(p-f,2),.5),e>n?t.zoomOut():t.zoomIn()}}(this),a=function(t){return function(t){if(n&&(2===t.originalEvent.changedTouches.length&&(h=t.originalEvent.changedTouches[0].pageX,l=t.originalEvent.changedTouches[1].pageX,p=t.originalEvent.changedTouches[0].pageY,f=t.originalEvent.changedTouches[1].pageY,n=!1,o()),1===t.originalEvent.changedTouches.length))return h<0?(h=t.originalEvent.changedTouches[0].pageX,p=t.originalEvent.changedTouches[0].pageY):(l=t.originalEvent.changedTouches[0].pageX,f=t.originalEvent.changedTouches[0].pageY,n=!1,o())}}(this),r=function(t){return function(t){var e;if(2===t.originalEvent.targetTouches.length)return n=!0,e=[-1,-1,-1,-1,-1,-1,-1,-1],c=e[0],u=e[1],h=e[2],l=e[3],d=e[4],v=e[5],p=e[6],f=e[7],c=t.originalEvent.targetTouches[0].pageX,u=t.originalEvent.targetTouches[1].pageX,d=t.originalEvent.targetTouches[0].pageY,v=t.originalEvent.targetTouches[1].pageY}}(this),$("#button_view_nat").click(t("nat",g)),$("#button_view_hhs").click(t("hhs",i)),$("#button_view_cen").click(t("cen",e)),$("#button_view_sta").click(t("sta",_)),$("#button_zoom_in").click(function(t){return function(){return t.zoomIn()}}(this)),$("#button_zoom_out").click(function(t){return function(){return t.zoomOut()}}(this)),this.dataTimeline=$("#dataTimeline"),this.canvasMap=$("#canvas_map"),this.canvasMap.mousemove(function(t){return function(e){var n,o,a,i,r,s;return r=t.hitTest(e.offsetX,e.offsetY),null!=r?($("#canvas_map").css("cursor","pointer"),t.renderMap(),n=t.canvasMap[0].getContext("2d"),n.font="12px sans-serif",n.fillStyle="#eee",o=t.mapData[r],i=""+Math.round(100*o.value)/100,xt.call(i,".")>=0?(i+="00",a=i.indexOf("."),i=i.slice(0,a+3)):i+=".00",s=""+Math.round(100*o.std)/100,xt.call(s,".")>=0?(s+="00",a=s.indexOf("."),s=s.slice(0,a+3)):s+=".00",i="("+i+"±"+s+")%",n.fillText(r+" "+i,e.offsetX,e.offsetY)):($("#canvas_map").css("cursor","auto"),t.renderMap())}}(this)),this.canvasMap.on("touchstart",r),this.canvasMap.on("touchend",a),this.canvasChart=$("#canvas_chart"),$(window).resize(function(t){return function(){return t.resizeCanvas()}}(this)),this.pointerInput=new m(this.canvasMap,this),this.canvasMap.focus(),this.currentPage=M,this.nonInfluenzaWeekSeason=w,this.setLocations(_),this.resetView(),this.resizeCanvas(),this.loadEpidata(),this.currentDetailedLoc=null,this.keyPressLock=0,$(document).keydown(function(t){return function(e){var n,o,a,i,r,s;if(0===t.keyPressLock&&(37===e.keyCode&&(t.keyPressLock=1,o=O(t.currentEpweek),t.currentEpweek=o[0],n=o[1],s=t.currentEpweek%100,39===s&&(t.nonInfluenzaWeekSeason=t.nonInfluenzaWeekSeason-1),t.loadEpidata(t.currentEpweek),null!=t.currentDetailedLoc&&t.fetchNowcast(t.currentDetailedLoc,t.currentEpweek)),38===e.keyCode&&(t.currentEpweek<t.maxEpiweek?(t.keyPressLock=1,a=H(t.currentEpweek),n=a[0],t.currentEpweek=a[1],t.currentEpweek=Math.min(t.currentEpweek,t.maxEpiweek),s=t.currentEpweek%100,50>s&&s>=40&&(t.nonInfluenzaWeekSeason=t.nonInfluenzaWeekSeason+1),t.loadEpidata(t.currentEpweek),null!=t.currentDetailedLoc&&t.fetchNowcast(t.currentDetailedLoc,t.currentEpweek)):(s=t.maxEpiweek%100,alert("Week"+s+" is the lastest data we had! Please check back next week!"))),39===e.keyCode&&(t.currentEpweek<t.maxEpiweek?(t.keyPressLock=1,i=O(t.currentEpweek),n=i[0],t.currentEpweek=i[1],s=t.currentEpweek%100,40===s&&(t.nonInfluenzaWeekSeason=t.nonInfluenzaWeekSeason+1),t.loadEpidata(t.currentEpweek),null!=t.currentDetailedLoc&&t.fetchNowcast(t.currentDetailedLoc,t.currentEpweek)):(s=t.maxEpiweek%100,alert("Week"+s+" is the lastest data we had! Please check back next week!"))),40===e.keyCode&&(t.keyPressLock=1,r=H(t.currentEpweek),t.currentEpweek=r[0],n=r[1],s=t.currentEpweek%100,40>s&&s>29&&(t.nonInfluenzaWeekSeason=t.nonInfluenzaWeekSeason-1),t.loadEpidata(t.currentEpweek),null!=t.currentDetailedLoc)))return t.fetchNowcast(t.currentDetailedLoc,t.currentEpweek)}}(this)),window.onpopstate=function(t){return function(e){return t.backToHome()}}(this),$("#back_arrow").click(function(t){return window.history.back()})}var f,M;return M=0,f=1,t.prototype.loadEpidata=function(t){var e,n,i,r,s,h,l,u,p;return null==t&&(t=null),null!=t?(l=t,p=O(l),h=p[0],e=p[1],r=b(l),s="("+S(r),r.setDate(r.getDate()+6),s=s+"-"+S(r)+")",this.dataTimeline.html(""),this.currentEpweek=l,i=function(t){return function(e){var n,a,i;return n=E(e,t.nonInfluenzaWeekSeason),a=function(e){var o,a,i,r,h,c,u;for(t.colors={},t.mapData={},a=D(n,e,l),c=0,r=e.length;c<r;c++)h=e[c],h.epiweek===l&&(i=h.value,u=a[h.location],o=("0"+Math.round(63+192*u).toString(16)).slice(-2),t.colors[h.location]="#"+o+"4040",t.mapData[h.location]=h);if(t.renderMap(),t.dataTimeline.html("Nowcasting epi-week "+l%100+" "+s),1===t.keyPressLock)return t.keyPressLock=0},i=P(a),o(i,c,h,l)}}(this),u=P(i),o(u,_,100*this.nonInfluenzaWeekSeason+40,100*(this.nonInfluenzaWeekSeason+1)+39)):(n=function(t){return function(e){return h=e[e.length-4].epiweek,l=e[e.length-1].epiweek,t.maxEpiweek=l,r=b(l),s="("+S(r),r.setDate(r.getDate()+6),s=s+"-"+S(r)+")",t.dataTimeline.html("Nowcasting epi-week "+l%100+" "+s),t.currentEpweek=l,i=function(e){var n,a;return n=E(e,t.nonInfluenzaWeekSeason),a=function(e){var o,a,i,r,s,h,c;for(t.colors={},t.mapData={},a=D(n,e,l),h=0,r=e.length;h<r;h++)s=e[h],s.epiweek===l&&(i=s.value,c=a[s.location],o=("0"+Math.round(63+192*c).toString(16)).slice(-2),t.colors[s.location]="#"+o+"4040",t.mapData[s.location]=s);return t.renderMap()},u=P(a),o(u,c,h,l)},u=P(i),o(u,_,100*t.nonInfluenzaWeekSeason+40,100*(t.nonInfluenzaWeekSeason+1)+39)}}(this),u=P(n),a(u,"nat"))},t.prototype.backToHome=function(){return this.currentPage=M,$(".pages").animate({left:"0%"},125)},t.prototype.showLocationDetails=function(t){var n,o,a;return this.currentPage=f,history.pushState({},""),$("#location_name").html(d[t]),$(".achievement_holder").hide(),$(".achievement_holder_top").hide(),$(".ili_note").hide(),n=t.toUpperCase(),xt.call(_,n)>=0&&($("#state_note").show(),$("#state_note_left").show(),$("#location_google1").show(),$("#location_twitter1").show(),$("#location_wiki0").show(),$("#location_cdc1").show(),$("#location_epicast0").show(),$("#location_arch0").show(),$("#location_sar30").show(),o=t.toUpperCase(),xt.call(r,o)>=0?$("#location_star1").show():$("#location_star0").show(),a=t.toUpperCase(),xt.call(s,a)>=0?$("#location_heart1").show():$("#location_heart0").show()),xt.call(i,t)>=0&&($("#hhs_note").show(),$("#hhs_note_left").show(),$("#location_google0").show(),$("#location_twitter1").show(),$("#location_wiki0").show(),$("#location_cdc1").show(),$("#location_epicast1").show(),$("#location_arch1").show(),$("#location_sar31").show()),xt.call(e,t)>=0&&($("#location_google0").show(),$("#location_twitter1").show(),$("#location_wiki0").show(),$("#location_cdc1").show(),$("#location_epicast0").show(),$("#location_arch1").show(),$("#location_sar31").show()),"nat"===t&&($("#location_google1").show(),$("#location_twitter1").show(),$("#location_wiki1").show(),$("#location_cdc1").show(),$("#location_epicast1").show(),$("#location_arch1").show(),$("#location_sar31").show()),$(".location_right").css("display","none"),$("#loading_icon").css("display","flex"),$(".pages").animate({left:"-100%"},125),this.currentDetailedLoc=t,this.fetchNowcast(t,this.currentEpweek)},t.prototype.setLocations=function(t){return this.locations=t,this.renderMapList(),this.renderMap()},t.prototype.resizeCanvas=function(){return this.canvasMap.attr("width",this.canvasMap.width()+"px"),this.canvasMap.attr("height",this.canvasMap.height()+"px"),this.canvasChart.attr("width",this.canvasChart.width()+"px"),this.canvasChart.attr("height",this.canvasChart.height()+"px"),this.renderMap(),this.renderChart()},t.prototype.resetView=function(){return this.dlat=35,this.dlon=-108.8,this.zoom=2.5,this.renderMap()},t.prototype.onClick=function(t,e){var n;if(n=this.hitTest(t,e),null!=n)return this.showLocationDetails(n)},t.prototype.onDrag=function(t,e,n,o){return this.dlon-=n/(4*this.zoom),this.dlat+=o/(4*this.zoom),this.dlat=Math.max(Math.min(this.dlat,h),l),this.dlon=Math.max(Math.min(this.dlon,u),p),this.renderMap()},t.prototype.onScroll=function(t){var e;return e=1+Math.abs(t)/500,t<0?this.zoomIn(e):this.zoomOut(e)},t.prototype.zoomIn=function(t){return null==t&&(t=1.5),this.zoom=Math.min(this.zoom*t,500),this.renderMap()},t.prototype.zoomOut=function(t){return null==t&&(t=1.5),this.zoom=Math.max(this.zoom/t,1.25),this.renderMap()},t.prototype.renderMapList=function(){var t,e,n,o,a,i,r,s,h;for($("#map_list ul").empty(),s=this,a=this.locations,h=0,e=a.length;h<e;h++)o=a[h],$("#map_list ul").append($("<li>").attr("class","map_list_element").attr("id","map_list_element_"+o).append($("<a>").attr("id","map_list_element_text_"+o).append(d[o])));for(i=this.locations,r=[],t=0,n=i.length;t<n;t++)o=i[t],$("#map_list_element_"+o).click(function(){return s.showLocationDetails(o)}),r.push($("#map_list_element_"+o).hover(function(t){var e,n,a,i;return o=this.id.substring(17),e=s.mapData[o],a=""+Math.round(100*e.value)/100,xt.call(a,".")>=0?(a+="00",n=a.indexOf("."),a=a.slice(0,n+3)):a+=".00",i=""+Math.round(100*e.std)/100,xt.call(i,".")>=0?(i+="00",n=i.indexOf("."),i=i.slice(0,n+3)):i+=".00",a="("+a+"±"+i+")%",$("#map_list_element_text_"+o).text(a),s.renderMap(o)},function(t){return o=this.id.substring(17),$("#map_list_element_text_"+o).text(d[o]),s.renderMap()}));return r},t.prototype.renderMap=function(t){var e,n,o,a,i,r,s,h,l,c,u,p,f,d,g,w,M,m,k,T,y,D,N,E,A,I,C,S,x,L,W,b,O,H,P,z,K,Y,X,F,U,J,G,Z,B,j,Q,tt,et,nt,ot,at,it,rt,st,ht,lt,ut,pt,ft,dt;for(null==t&&(t=null),H=[this.canvasMap.width(),this.canvasMap.height()],lt=H[0],r=H[1],i=this.canvasMap[0].getContext("2d"),i.clearRect(0,0,lt,r),i.strokeStyle="#000",i.lineWidth=1,E={0:function(t,e){return i.moveTo(t,e)},1:function(t,e){return i.lineTo(t,e)}},this.ecef2ortho=R(this.dlat,this.dlon,this.zoom,lt,r),P=this.locations,st=0,T=P.length;st<T;st++)if(I=P[st],I!==t)for(z=geodata.locations[I].paths,s=0,y=z.length;s<y;s++){for(ct=z[s],i.beginPath(),A=0,l=0,D=ct.length;l<D;l++)h=ct[l],E[A].apply(E,this.ecef2ortho.apply(this,geodata.points[h])),A|=1;i.closePath(),i.fillStyle=null!=(K=null!=(Y=this.colors)?Y[I]:void 0)?K:"#ccc",i.fill(),i.stroke()}if(null!=t)if(i.font="12px sans-serif",i.strokeStyle="#eee",t in v){for(i.lineWidth=.5,X=v[t],c=0,p=X.length;c<p;c++)for(I=X[c],F=geodata.locations[I].paths,u=0,f=F.length;u<f;u++){for(ct=F[u],i.beginPath(),A=0,S=0,d=ct.length;S<d;S++)h=ct[S],E[A].apply(E,this.ecef2ortho.apply(this,geodata.points[h])),A|=1;i.closePath(),i.fillStyle=null!=(U=null!=(J=this.colors)?J[I]:void 0)?U:"#ccc",i.fill(),i.stroke()}for(i.lineWidth=1.5,G=geodata.locations[t].paths,x=0,g=G.length;x<g;x++){for(ct=G[x],i.beginPath(),A=0,L=0,w=ct.length;L<w;L++)h=ct[L],E[A].apply(E,this.ecef2ortho.apply(this,geodata.points[h])),A|=1;i.closePath(),i.stroke()}for(Z=v[t],W=0,M=Z.length;W<M;W++)I=Z[W],i.fillStyle="#eee",B=this.locCenterOnMap(I),o=B[0],a=B[1],i.fillText(I,o,a)}else{for(i.lineWidth=1.5,j=geodata.locations[t].paths,b=0,m=j.length;b<m;b++){for(ct=j[b],i.beginPath(),A=0,O=0,k=ct.length;O<k;O++)h=ct[O],E[A].apply(E,this.ecef2ortho.apply(this,geodata.points[h])),A|=1;i.closePath(),i.fillStyle=null!=(Q=null!=(tt=this.colors)?tt[I]:void 0)?Q:"#ccc",i.fill(),i.stroke()}i.fillStyle="#eee",et=this.locCenterOnMap(t),o=et[0],a=et[1],i.fillText(t,o,a)}for("AK"!==t&&(nt=this.locCenterOnMap("AK"),o=nt[0],a=nt[1],i.font="12px sans-serif",i.fillStyle="#eee",i.fillText("AK",o,a)),"HI"!==t&&(ot=this.locCenterOnMap("HI"),o=ot[0],a=ot[1],i.font="12px sans-serif",i.fillStyle="#eee",i.fillText("HI",o,a)),this.locations===_&&(i.font=12*Math.max(.7,lt/1e3)+"px sans-serif",i.fillStyle="#eee",ut=lt/3,lt<600&&(ut=lt/5),i.fillText("NOTE 1: %ILI is not meaningfully comparable between states,",ut,r-24-24*Math.max(.7,lt/1e3)),i.fillText("               due to differences in reporter types.",ut,r-24-12*Math.max(.7,lt/1e3)),i.fillText("NOTE 2: Color intensity is similar to, but not the same as, CDC’s Flu Activity Level.",ut,r-24)),ft=32,e=$("#map_list"),"hidden"!==e.css("visibility")&&(ft+=e.position().left+e.width()),at=[lt/25,r/2],C=at[0],N=at[1],it=[ft,r/10,ft+C,r/10+N],pt=it[0],dt=it[1],It=it[2],St=it[3],i.strokeStyle="#000",i.lineWidth=.5,V=rt=1;rt<=10;V=++rt)i.beginPath(),i.moveTo(pt,dt+(V-1)*(N/10)),i.lineTo(pt,dt+V*(N/10)),i.lineTo(It,dt+V*(N/10)),i.lineTo(It,dt+(V-1)*(N/10)),i.lineTo(pt,dt+(V-1)*(N/10)),i.closePath(),ht=q(11-V),n=("0"+Math.round(63+192*ht).toString(16)).slice(-2),i.fillStyle="#"+n+"4040",i.fill(),i.stroke();return i.fillStyle="#eee",i.font="12px sans-serif",i.fillText("Highest",pt+C/4,dt-Math.min(10,N/10)),i.fillText("Lowest",pt+C/4,St+Math.min(16,N/10)),0},t.prototype.renderChart=function(){var t,e,n,o,a,r,s,h,l,c,u,p,f,d,g,w,M,m,v,k,_,T,y,D,N,E,A,S,$,x,L,W,b,O,H,P,z,R,K,Y;if(null!=this.chartData){for(D=[this.canvasChart.width(),this.canvasChart.height()],H=D[0],a=D[1],e=this.canvasChart[0].getContext("2d"),e.fillStyle="#ddd",e.fillRect(0,0,H,a),e.fillStyle="#000",e.strokeStyle="#000",e.setLineDash([1,0]),e.lineWidth=.005*(H+a)/2,m={0:function(t,n){return e.moveTo(t,n)},1:function(t,n){return e.lineTo(t,n)}},T={left:64,right:20,top:36,bottom:64},t={width:H-T.left-T.right,height:a-T.top-T.bottom},_=this.chartData.length,N=this.chartData,W=0,w=N.length;W<w;W++)L=N[W],k=Math.max(null!=k?k:L.value,L.value);for(k=Math.round(k+1),s=function(e){return T.left+t.width*e/(_-1)},c=function(e){return T.top+t.height*(1-e/k)},b=function(t,n){var o,a,i,r;for(i=0,e.beginPath(),o=a=0,r=t.length;0<=r?a<r:a>r;o=0<=r?++a:--a)m[i](t[o],n[o]),i|=1;return e.stroke()},z=function(t,n,o,a){var i,r;return i=e.measureText("W").width,r=e.measureText(t).width,e.save(),e.translate(n,o),e.rotate(a*Math.PI*2),e.translate(-r/2,+i/2),e.fillText(t,0,0),e.restore()},b([0,_-1].map(s),[0,0].map(c)),b([0,0].map(s),[0,k].map(c)),e.font="16px sans-serif",z("Time (weeks)",H/2,a-T.bottom/3,0),y=this.chartData[0].location.length>2?"Weighted ":"",z(y+"%ILI",T.left/3,a/2,-.25),e.font="12px sans-serif",l=r=0,E=k;0<=E?r<=E:r>=E;l=0<=E?++r:--r)K=c(l),b([T.left-6,T.left],[K,K]),(t.height/k>=32||l%2===0)&&z(l,3*T.left/4,K,0);for(A=function(){var t,e,n;for(n=[],V=t=0,e=_-10;0<=e?t<e:t>e;V=0<=e?++t:--t)n.push(V);return n}().concat([_-1]),f=0,M=A.length;f<M;f++)V=A[f],P=this.chartData[V].epiweek%100,20!==P&&40!==P&&V!==_-1||(R=s(V),b([R,R],[a-T.bottom,a-(T.bottom-6)]),Y=Math.round(this.chartData[V].epiweek/100)%100,Y=("00"+Y).slice(-2),P=("00"+P).slice(-2),z("'"+Y+"w"+P,R,a-2*T.bottom/3,-.125));if(e.lineWidth=e.lineWidth/2,h=function(){var t,e,n;for(n=[],V=t=0,e=_;0<=e?t<e:t>e;V=0<=e?++t:--t)n.push(V);return n}(),null!=this.truthData&&(u=function(){var t,e,n;for(n=[],V=t=0,e=this.truthData.length;0<=e?t<e:t>e;V=0<=e?++t:--t)n.push(this.truthData[V].wili);return n}.call(this),b(h.map(s),u.map(c))),e.strokeStyle="#FF0000",u=function(){var t,e,n;for(n=[],V=t=0,e=_;0<=e?t<e:t>e;V=0<=e?++t:--t)n.push(this.chartData[V].value);return n}.call(this),b(h.map(s),u.map(c)),v=this.chartData[0].location,xt.call(i,v)>=0||"nat"===v)for(e.strokeStyle="#008080",e.setLineDash([5,3]),V=d=0,S=_;0<=S?d<S:d>S;V=0<=S?++d:--d)P=this.chartData[V].epiweek%100,40===P&&(Y=Math.round(this.chartData[V].epiweek/100),p=baselinedata[v][Y],null!=p&&(e.beginPath(),e.moveTo(s(V),c(p)),V+32<_?e.lineTo(s(V+32),c(p)):e.lineTo(s(_-1),c(p)),e.stroke()));for(e.setLineDash([1,0]),e.strokeStyle="green",V=g=0,$=_-1;0<=$?g<=$:g>=$;V=0<=$?++g:--g)this.chartData[V].epiweek===this.currentEpweek&&(n=this.chartData[V],I=s(V),C=c(n.value),x=[c(n.value+n.std),c(n.value-n.std)],O=x[0],o=x[1],e.beginPath(),e.moveTo(I,O),e.lineTo(I,o),e.stroke(),e.beginPath(),e.moveTo(I-2*(s(2)-s(1)),O),e.lineTo(I+2*(s(2)-s(1)),O),e.stroke(),e.beginPath(),e.moveTo(I-2*(s(2)-s(1)),o),e.lineTo(I+2*(s(2)-s(1)),o),e.stroke(),e.beginPath(),e.arc(I,C,2,0,2*Math.PI,!1),e.fillStyle="green",e.fill(),e.strokeStyle="#FF0000",e.fillStyle="#000");return e.font=12*Math.min(1,H/500)+"px sans-serif",e.lineWidth=e.lineWidth/2,z("Nowcast",H-3*T.right,T.top,0),e.beginPath(),e.moveTo(H-6*T.right,T.top),e.lineTo(H-5*T.right,T.top),e.stroke(),null!=this.truthData&&(e.strokeStyle="#000",z("Ground Truth",H-3*T.right,1.5*T.top,0),e.beginPath(),e.moveTo(H-6*T.right,1.5*T.top),e.lineTo(H-5*T.right,1.5*T.top),e.stroke()),(xt.call(i,v)>=0||"nat"===v)&&(e.strokeStyle="#008080",e.setLineDash([5,3]),z("CDC Baseline",H-3*T.right,2*T.top,0),e.beginPath(),e.moveTo(H-6*T.right,2*T.top),e.lineTo(H-5*T.right,2*T.top),e.stroke()),e.font=24*Math.min(1,H/500)+"px sans-serif",z("Historical Nowcasts (out-of-sample)",H/2,T.top/2,0)}},t.prototype.hitTest=function(t,e){var n,o,a,i,r,s,h,l,c,u,p,f,d,g,w,M,m,v;for(l=this.locations,g=0,r=l.length;g<r;g++)for(h=l[g],c=geodata.locations[h].paths,o=0,s=c.length;o<s;o++){for(ct=c[o],n=!1,u=this.ecef2ortho.apply(this,geodata.points[ct[0]]),w=u[0],m=u[1],a=i=1,p=ct.length;1<=p?i<=p:i>=p;a=1<=p?++i:--i)f=this.ecef2ortho.apply(this,geodata.points[ct[a%ct.length]]),M=f[0],v=f[1],m>e!=v>e&&(w>t||M>t)&&(w>t&&M>t||w+(e-m)*(M-w)/(v-m)>t)&&(n=!n),d=[M,v],w=d[0],m=d[1];if(n)return h}return null},t.prototype.locCenterOnMap=function(t){var e,n,o,a,i,r,s,h,l,c,u,p,f;for(i=[0,0,0],I=i[0],C=i[1],o=i[2],r=geodata.locations[t].paths,u=0,a=r.length;u<a;u++)for(ct=r[u],n=e=1,s=ct.length;1<=s?e<=s:e>=s;n=1<=s?++e:--e)h=this.ecef2ortho.apply(this,geodata.points[ct[n%ct.length]]),p=h[0],f=h[1],l=[I+p,C+f],I=l[0],C=l[1],o++;return c=[I/o,C/o],I=c[0],C=c[1],"AK"===t&&(C-=10),[I,C]},t.prototype.fetchNowcast=function(t,e){var n;return this.chartData=null,this.truthData=null,n=function(t){return function(n){return t.onNowcastReceived(n,e)}}(this),a(P(n),t)},t.prototype.onNowcastReceived=function(t,e){var o,a,i,r,s,h,l,c,u,p,f,d,w,M,m;for(w=0,c=t.length;w<c;w++)p=t[w],p.epiweek===e&&(a=p);return f=t[0],i=t[t.length-1],M=i.epiweek%100,m=Math.floor(i.epiweek/100),r=i.epiweek-10,M>40&&(r=100*m+39),M<20&&(r=100*(m-1)+39),u=a.location,(xt.call(k,u)>=0||xt.call(g,u)>=0)&&(o=function(t){return function(e){return t.onFluviewReceived(e)}}(this),n(P(o),u,f.epiweek+"-"+r)),l=""+Math.round(100*a.value)/100,xt.call(l,".")>=0?(l+="00",h=l.indexOf("."),l=l.slice(0,h+3)):l+=".00",d=""+Math.round(100*a.std)/100,xt.call(d,".")>=0?(d+="00",h=d.indexOf("."),d=d.slice(0,h+3)):d+=".00",l="("+l+"&#177;"+d+")",s=a.epiweek%100,this.chartData=t,$("#nowcast_label").text("ILI nowcast for "+u+" for epi-week "+s+":"),$("#nowcast_label_left").text("ILI nowcast for "+u+" for epi-week "+s+":"),$("#nowcast_value").html(l+"%"),$("#nowcast_value_left").html(l+"%"),$("#chart_label").text("Historical ILI nowcasts for "+u+":"),$(".location_right").css("display","block"),$("#loading_icon").css("display","none"),this.resizeCanvas()},t.prototype.onFluviewReceived=function(t){return this.truthData=t,this.resizeCanvas()},t}()}).call(this);